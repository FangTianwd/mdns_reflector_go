# 更新日志

所有显著的更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)，
并遵循 [Semantic Versioning](https://semver.org/spec/v2.0.0.html)。

## [1.2.0] - 2025-11-23

### ✨ 新增功能

- **智能配置路径管理**: 新增用户级和系统级配置路径自动检测
  - 优先使用用户级配置目录 (`~/Library/Application Support/FangTianwd.mdns-reflector-go/`)
  - 自动回退到系统级配置目录 (保持向后兼容性)
  - 支持自定义配置文件路径参数

- **增强的mDNS报文解析**: 新增报文内容解析和显示功能
  - 解析DNS查询和响应报文
  - 显示查询名称和类型信息
  - 更详细的转发日志记录

- **全局网络监听优化**: 重构网络监听架构
  - 使用单个全局监听器处理所有接口
  - 减少系统资源占用
  - 改进报文转发效率

- **增量配置更新**: 配置文件支持增量更新
  - 保存配置时保留现有设置
  - 支持独立更新接口配置和日志级别
  - 权限不足时自动回退到用户目录

### 🔧 技术改进

- **Go版本升级**: 从Go 1.23升级到Go 1.24.0
- **依赖管理优化**: 添加golang.org/x/net依赖支持DNS报文解析
- **错误处理增强**: 当配置路径获取失败时返回错误而非使用无效路径
- **代码架构重构**: 模块化设计，提高代码可维护性

### 📚 文档完善

- **新增命令行参数**:
  - `-config`: 指定自定义配置文件路径
  - `-config-log-level`: 持久化设置日志级别
- **配置示例更新**: 添加新配置选项说明
- **错误处理文档**: 完善错误信息和解决方法

### 🐛 修复

- 修复配置路径初始化逻辑，避免使用无效路径
- 改进权限不足时的错误处理和用户提示
- 优化网络监听器的资源管理

## [1.1.0] - 2025-11-23

### ✨ 新增功能

- **灵活调试日志系统**: 新增完整的日志管理功能
  - 支持4级日志: `debug`、`info`、`warn`、`error`
  - 命令行参数 `--log-level` 控制日志级别
  - 配置文件持久化日志级别设置
  - 结构化日志输出，包含时间戳和级别标识

- **配置增强**: 扩展配置文件支持日志级别设置
  ```yaml
  ifaces:
    - en0
    - en1
  log_level: debug  # 新增配置项
  ```

### 🔧 技术改进

- **代码架构重构**: 从单体函数式设计改为面向对象设计
  - 引入 `Reflector` 结构体封装状态
  - 模块化设计，提高代码可维护性
  - 职责分离，单一功能原则

- **并发安全优化**: 增强多goroutine环境的安全性
  - 使用 `sync.Map` 替代普通map
  - 线程安全的连接管理
  - 防止竞态条件

- **错误处理升级**: 现代化错误处理策略
  - 错误传播而非直接退出
  - 统一的错误处理模式
  - 更详细的错误信息

- **资源管理改进**: 优雅的资源生命周期管理
  - context + 信号处理实现优雅关闭
  - WaitGroup 协调goroutine生命周期
  - 防止goroutine泄漏

### 📚 文档完善

- **README更新**: 完整的使用指南和示例
- **配置示例**: 新增配置文件模板
- **演示脚本**: 日志功能使用演示
- **API文档**: 详细的参数说明

### 🐛 修复

- 优化网络接口验证逻辑
- 改进配置文件路径处理
- 增强跨平台兼容性

### 🔄 内部变更

- 重构函数签名，支持依赖注入
- 优化常量定义，减少重复计算
- 改进构建标签和条件编译
- 代码格式化和注释完善

## [1.0.4] - 2025-11-22

### 🔧 技术改进

- 修复Makefile缩进问题
- 优化GitHub Actions发布流程
- 改进版本号处理逻辑

## [1.0.3] - 2025-11-22

### 🔧 技术改进

- 保持版本号前缀一致性
- 修复文件名生成问题

## [1.0.2] - 2025-11-22

### ✨ 新增功能

- 支持多平台二进制发布
- 自动化发布流程
- Homebrew Formula支持

### 🔧 技术改进

- 优化构建脚本
- 改进错误处理
- 增强可维护性

## [1.0.1] - 2025-11-22

### 🐛 修复

- 修复网络接口配置问题
- 优化错误处理逻辑

## [1.0.0] - 2025-11-22

### ✨ 新增功能

- 核心mDNS反射功能
- 多网络接口支持
- 配置文件支持
- 基本的错误处理

### 📦 初始发布

首个稳定版本，实现了基本的mDNS报文转发功能。
